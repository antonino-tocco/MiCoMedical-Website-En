App.controller("MapController",["$scope","regions",function($scope,regions){$scope.regions=[],$scope.regionsColor={},$scope.markers=[];var geocoder=new google.maps.Geocoder;regions.getByDistributorPresence().then(function(result){if("OK"==result.errorCode){result.regions.forEach(function(item){$scope.regions.push(item);var code=item.code,distributorList="";_.each(item.associatedUsers,function(user){distributorList+=user.name+"<br />"});var region=item.name,format_address=(item.associatedUsers[0].province.name,item.associatedUsers[0].town.name,item.associatedUsers[0].address,region);geocoder.geocode({address:format_address},function(results,status){if(status===google.maps.GeocoderStatus.OK){results[0].geometry.location.lat(),results[0].geometry.location.lng()}$scope.$apply()}),$scope.regionsColor[code]="#4DB1E2"});var map=new jvm.Map({map:"it_regions_mill",container:jQuery("#map-italy"),backgroundColor:"transparent",zoomOnScroll:!1,regionStyle:{initial:{fill:"rgba(37,151,222,0.25)","fill-opacity":1,stroke:"#CCC","stroke-width":2,"stroke-opacity":1},hover:{"fill-opacity":.8}},series:{regions:[{attribute:"fill"}]},onRegionTipShow:function(event,label,code){var selectedItem=_.find($scope.regions,function(item){return item.code==code}),htmlString="";selectedItem&&selectedItem.associatedUsers&&(_.each(selectedItem.associatedUsers,function(user){htmlString+=user.name+"\n"}),label.html(htmlString))}});map.series.regions[0].setValues($scope.regionsColor)}})}]);