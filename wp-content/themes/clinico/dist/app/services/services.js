var BEService=angular.module("BEServiceModule",[]).factory("constants",[function(){return{CATEGORY:"CATEGORY_",TOOL:"TOOL_",REGION:"REGION_",PROVINCE:"PROVINCE_",TOWN:"TOWN_",NEWS_CAT:"73",EVENTS_CAT:"74"}}]).service("storage",[function(){hashCode=function(s){return(s+"").split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0)};var memorycache={};return{get:function(key){var value=memorycache[hashCode(key)];return value?JSON.parse(value):void 0},set:function(key,value){memorycache[hashCode(key)]=JSON.stringify(value)},"delete":function(key){console.debug("Remove object with key : "+key),delete memorycache[hashCode(key)]}}}]).service("queryEngine",["$http","constants",function($http,constants){var baseUrl="http://www.micomedical.it/area_riservata/web/",jsonAPIBaseUrl="http://www.micomedical.it/en/",apiService=baseUrl+"api/v1/",registerService=baseUrl+"app_dev.php/site/register",getPost=jsonAPIBaseUrl+"?json=get_posts",get=function(url,success,error){$http({method:"GET",url:url}).then(success,error)},post=function(url,data,success,error){jQuery.ajax({method:"POST",url:url,data:data,dataType:"json"}).then(success,error)};return{getRegionByDistributorPresence:function(success,error){get(apiService+"region/get_by_distributor",success,error)},getAllRegions:function(success,error){get(apiService+"region/getAll",success,error)},getProvincesByRegion:function(data,success,error){get(apiService+"province/getByRegion/"+data.region,success,error)},getTownsByProvince:function(data,success,error){get(apiService+"town/getByProvince/"+data.province,success,error)},getPostCodeByTown:function(data,success,error){get(apiService+"post_code/getByTown/"+data.town,data,success,error)},getToolCategory:function(id,success,error){get(apiService+"tool_category/get/"+id,success,error)},getAllToolCategories:function(success,error){get(apiService+"tool_category/getAll",success,error)},getToolByCategory:function(id,success,error){get(apiService+"tool/get_by_category/"+id,success,error)},getTool:function(id,success,error){get(apiService+"tool/get/"+id,success,error)},getAllTool:function(success,error){get(apiService+"tool/getAll",success,error)},registerUser:function(data,success,error){post(registerService,data,success,error)},getNews:function(data,success,error){var url=getPost;for(var key in data)"limit"!==key&&(url+="&"+key+"="+data[key]);get(url,success,error)},getEvents:function(data,success,error){var url=getPost;for(var key in data)"limit"!==key&&(url+="&"+key+"="+data[key]);get(url,success,error)}}}]).service("location",["$q",function($q){var jsonLocation="/wp-content/themes/clinico/app/json/location.json";return{getRegion:function(){var deferred=$q.defer();return jQuery.getJSON(jsonLocation,function(data){deferred.resolve(data)}),deferred.promise},getProvinces:function(region){return region.provincie},getTowns:function(province){return province.comuni},getCap:function(town){return town.cap}}}]).service("productCategories",["queryEngine","$q","constants","storage",function(queryEngine,$q,constants,storage){var module={};return module.getAll=function(){var deferred=$q.defer();return queryEngine.getAllToolCategories(function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module.get=function(id){var deferred=$q.defer(),productCategory=storage.get(constants.CATEGORY+id);return productCategory?deferred.resolve(productCategory):queryEngine.getToolCategory(id,function(result){var data=result.data;module.data=data,module.save,deferred.resolve(module)}),deferred.promise},module.save=function(id){storage.set(constants.TOOL+id,this)},module}]).service("products",["queryEngine","$q","constants","storage",function(queryEngine,$q,constants,storage){var module={};return module.getAll=function(){var deferred=$q.defer();return queryEngine.getAllTool(function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module.get=function(id){var deferred=$q.defer(),product=storage.get(constants.TOOL+id);return product?deferred.resolve(product):queryEngine.getTool(id,function(result){var data=result.data;module.data=data,module.save(),deferred.resolve(module)}),deferred.promise},module.getByCategory=function(id){var deferred=$q.defer();return queryEngine.getToolByCategory(id,function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module.save=function(id){storage.set(constants.TOOL+id,this)},module}]).service("regions",["queryEngine","$q",function(queryEngine,$q){var module={};return module.getAll=function(){var deferred=$q.defer();return queryEngine.getAllRegions(function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module.getByDistributorPresence=function(){var deferred=$q.defer();return queryEngine.getRegionByDistributorPresence(function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module}]).service("provinces",["queryEngine","$q",function(queryEngine,$q){var module={};return module.getByRegion=function(data){var deferred=$q.defer();return queryEngine.getProvincesByRegion(data,function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module}]).service("towns",["queryEngine","$q",function(queryEngine,$q){var module={};return module.getByProvince=function(data){var deferred=$q.defer();return queryEngine.getTownsByProvince(data,function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module}]).service("postCode",["queryEngine","$q",function(queryEngine,$q){var module={};return module.getByTown=function(data){var deferred=$q.defer();return queryEngine.getPostCodeByTown(data,function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module}]).service("user",["queryEngine","$q",function(queryEngine,$q){var module={};return module.registerUser=function(data){var deferred=$q.defer();return queryEngine.registerUser(data,function(result){deferred.resolve(result)}),deferred.promise},module}]).service("news",["queryEngine","$q","constants",function(queryEngine,$q,constants){var module={};return module.getNews=function(limit){var deferred=$q.defer(),data={cat:constants.NEWS_CAT,orderby:"date",order:"DESC"};return queryEngine.getNews(data,function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module}]).service("events",["queryEngine","$q","constants",function(queryEngine,$q,constants){var module={};return module.getEvents=function(limit){var deferred=$q.defer(),data={cat:constants.EVENTS_CAT,orderby:"date",order:"DESC"};return queryEngine.getEvents(data,function(result){var data=result.data;deferred.resolve(data)}),deferred.promise},module}]);